(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8105],{403:(e,t,a)=>{Promise.resolve().then(a.bind(a,73199))},44642:(e,t,a)=>{"use strict";a.d(t,{MI:()=>f,kh:()=>x,np:()=>p});var s=a(95155),r=a(34548),n=a(30347),l=a(60922),i=a(35317),o=a(4382);let d={review_word:5,spell_correct:5,daily_login:20,master_word:10,grammar_test:20},c=e=>({timeSpentSeconds:0,totalWordsReviewed:0,xp:0,reviewedToday:{count:0,date:e,timeSpentSeconds:0,completedTests:[]},activityLog:[],spellingPractice:{count:0,date:e},lastLoginDate:"1970-01-01",weekStartDate:(0,r.k)(new Date,{weekStartsOn:1}).toISOString(),lastWeek:null,hasSeenLastWeekResults:!0});async function m(e){let t=query((0,i.rJ)(o.db,"users"),where("supervisorId","==",e)),a=await (0,i.GG)(t);return await Promise.all(a.docs.map(async e=>{let t={...e.data(),id:e.id},a=await f(t.id);return{user:t,stats:a}}))}let f=async e=>{var t,a;let s,l,d=new Date,f=d.toLocaleDateString("en-CA"),x=(0,r.k)(d,{weekStartsOn:1}),p="".concat(d.getFullYear(),"-").concat((0,n.N)(d,{weekStartsOn:1})),g=(0,i.H9)(o.db,"users/".concat(e,"/app-data/stats")),h=await (0,i.x7)(g);h.exists()?s=h.data():(s=c(f),await (0,i.BN)(g,s)),"number"!=typeof s.xp&&(s.xp=0),s.lastLoginDate||(s.lastLoginDate="1970-01-01"),s.weekStartDate||(s.weekStartDate=x.toISOString()),"boolean"!=typeof s.hasSeenLastWeekResults&&(s.hasSeenLastWeekResults=!0);let w=new Date(s.weekStartDate),y="".concat(w.getFullYear(),"-").concat((0,n.N)(w,{weekStartsOn:1}));if(p!==y&&!(null==(a=s.lastWeek)||null==(t=a.weekId)?void 0:t.endsWith(y))&&(null==(l=await u(e))?void 0:l.supervisorId)){let e=await m(l.supervisorId),t=e.map(e=>{let{user:t,stats:a}=e;return{...t,xp:a.xp}}).sort((e,t)=>t.xp-e.xp).slice(0,3).map((e,t)=>({id:e.id,name:e.name,avatar:e.avatar,xp:e.xp,rank:t+1}));for(let{user:a}of e){let e=(0,i.H9)(o.db,"users/".concat(a.id,"/app-data/stats"));await (0,i.BN)(e,{xp:0,weekStartDate:x.toISOString(),lastWeek:{weekId:y,winners:t},hasSeenLastWeekResults:!1},{merge:!0})}let a=await (0,i.x7)(g);a.exists()&&(s=a.data())}return s.reviewedToday&&s.reviewedToday.date===f||(s.reviewedToday={count:0,date:f,timeSpentSeconds:0,completedTests:[]}),s.spellingPractice&&s.spellingPractice.date===f||(s.spellingPractice={count:0,date:f}),Array.isArray(s.activityLog)||(s.activityLog=[]),Array.isArray(s.reviewedToday.completedTests)||(s.reviewedToday.completedTests=[]),"number"!=typeof s.reviewedToday.timeSpentSeconds&&(s.reviewedToday.timeSpentSeconds=0),s},x=async(e,t)=>{if(!e)return{updated:!1,amount:0};let a=await f(e),s=d[t],r=new Date().toLocaleDateString("en-CA");if("daily_login"===t){if(a.lastLoginDate===r)return{updated:!1,amount:0};a.lastLoginDate=r}a.xp+=s;let n=(0,i.H9)(o.db,"users/".concat(e,"/app-data/stats"));return await (0,i.BN)(n,a,{merge:!0}),{updated:!0,amount:s}},p=async e=>{let{userId:t,reviewedCount:a=0,durationSeconds:r=0,testName:n,spelledCount:c=0,toast:m,markAsSeen:x=!1}=e;if(!t)return;let p=await f(t),u=new Date().toLocaleDateString("en-CA");p.totalWordsReviewed+=a,p.timeSpentSeconds+=r,p.reviewedToday.count+=a,p.reviewedToday.timeSpentSeconds+=r,p.spellingPractice.count+=c,p.activityLog.includes(u)||p.activityLog.push(u),n&&!p.reviewedToday.completedTests.includes(n)&&(p.reviewedToday.completedTests.push(n),p.xp+=d.grammar_test,m&&m({description:(0,s.jsx)(l.Y,{event:"grammar_test",amount:d.grammar_test}),duration:3e3})),x&&(p.hasSeenLastWeekResults=!0);let g=(0,i.H9)(o.db,"users/".concat(t,"/app-data/stats"));await (0,i.BN)(g,p,{merge:!0})};async function u(e){if(!e)return;let t=(0,i.H9)(o.db,"users",e),a=await (0,i.x7)(t);if(!a.exists())return;let s=a.data();return s.trialExpiresAt&&s.trialExpiresAt instanceof Timestamp&&(s.trialExpiresAt=s.trialExpiresAt.toDate().toISOString()),{...s,id:a.id}}},54165:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>f,Es:()=>p,L3:()=>u,c7:()=>x,lG:()=>o,rr:()=>g,zM:()=>d});var s=a(95155),r=a(12115),n=a(15452),l=a(25318),i=a(59434);let o=n.bL,d=n.l9,c=n.ZL;n.bm;let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});m.displayName=n.hJ.displayName;let f=r.forwardRef((e,t)=>{let{className:a,children:r,...o}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(m,{}),(0,s.jsxs)(n.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:[r,(0,s.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(l.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});f.displayName=n.UC.displayName;let x=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};x.displayName="DialogHeader";let p=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};p.displayName="DialogFooter";let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});u.displayName=n.hE.displayName;let g=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...r})});g.displayName=n.VY.displayName},59434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var s=a(52596),r=a(39688);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},60922:(e,t,a)=>{"use strict";a.d(t,{Y:()=>m});var s=a(95155),r=a(31550),n=a(77724),l=a(51920),i=a(85268),o=a(30462),d=a(20794);let c={review_word:(0,s.jsx)(r.A,{className:"h-5 w-5 text-green-500"}),spell_correct:(0,s.jsx)(n.A,{className:"h-5 w-5 text-green-500"}),daily_login:(0,s.jsx)(l.A,{className:"h-5 w-5 text-green-500"}),master_word:(0,s.jsx)(i.A,{className:"h-5 w-5 text-yellow-500"}),grammar_test:(0,s.jsx)(i.A,{className:"h-5 w-5 text-yellow-500"})};function m(e){let{event:t,amount:a}=e,{t:r}=(0,d.o)(),n=r("xpEvents.".concat(t)),l=c[t];return(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[l,(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-semibold",children:n}),(0,s.jsxs)("span",{className:"flex items-center gap-1 text-sm text-yellow-500 font-bold",children:["+",a," XP",(0,s.jsx)(o.A,{className:"h-4 w-4 fill-current"})]})]})]})}},66695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>l,aR:()=>i,wL:()=>m});var s=a(95155),r=a(12115),n=a(59434);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});l.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})});i.displayName="CardHeader";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});o.displayName="CardTitle";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});d.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...r})});c.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})});m.displayName="CardFooter"},73199:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var s=a(95155),r=a(12115),n=a(35695),l=a(9086),i=a(66695),o=a(66766),d=a(85268),c=a(44642),m=a(59434),f=a(65119),x=a(23580),p=a(25532),u=a(20794),g=a(11518),h=a.n(g),w=a(54165),y=a(30285),v=a(30462);let j=()=>(0,s.jsx)("div",{className:"absolute top-0 left-0 w-full h-full pointer-events-none overflow-hidden z-50",children:[...Array(150)].map((e,t)=>(0,s.jsx)("div",{className:"confetti-piece",style:{left:"".concat(100*Math.random(),"%"),animationDuration:"".concat(3*Math.random()+2,"s"),animationDelay:"".concat(2*Math.random(),"s"),backgroundColor:"hsl(".concat(360*Math.random(),", 70%, 50%)")}},t))});function N(e){let{isOpen:t,onClose:a,winners:r,currentUserId:n}=e,l=r.find(e=>e.id===n);return(0,s.jsxs)(w.lG,{open:t,onOpenChange:a,children:[(0,s.jsx)(h(),{id:"5161af47ea9df57d",children:".confetti-piece{position:absolute;width:8px;height:16px;-webkit-border-radius:4px;-moz-border-radius:4px;border-radius:4px;opacity:.7;-webkit-animation:fall 5s linear infinite;-moz-animation:fall 5s linear infinite;-o-animation:fall 5s linear infinite;animation:fall 5s linear infinite}@-webkit-keyframes fall{0%{-webkit-transform:translatey(-10vh)rotatez(0deg);transform:translatey(-10vh)rotatez(0deg)}100%{-webkit-transform:translatey(110vh)rotatez(720deg);transform:translatey(110vh)rotatez(720deg)}}@-moz-keyframes fall{0%{-moz-transform:translatey(-10vh)rotatez(0deg);transform:translatey(-10vh)rotatez(0deg)}100%{-moz-transform:translatey(110vh)rotatez(720deg);transform:translatey(110vh)rotatez(720deg)}}@-o-keyframes fall{0%{-o-transform:translatey(-10vh)rotatez(0deg);transform:translatey(-10vh)rotatez(0deg)}100%{-o-transform:translatey(110vh)rotatez(720deg);transform:translatey(110vh)rotatez(720deg)}}@keyframes fall{0%{-webkit-transform:translatey(-10vh)rotatez(0deg);-moz-transform:translatey(-10vh)rotatez(0deg);-o-transform:translatey(-10vh)rotatez(0deg);transform:translatey(-10vh)rotatez(0deg)}100%{-webkit-transform:translatey(110vh)rotatez(720deg);-moz-transform:translatey(110vh)rotatez(720deg);-o-transform:translatey(110vh)rotatez(720deg);transform:translatey(110vh)rotatez(720deg)}}"}),(0,s.jsxs)(w.Cf,{className:"max-w-md",children:[(0,s.jsx)(j,{}),(0,s.jsxs)(w.c7,{children:[(0,s.jsx)(w.L3,{className:"text-center text-2xl font-headline",children:"Last Week's Champions!"}),(0,s.jsx)(w.rr,{className:"text-center",children:(()=>{if(!l)return"Great effort last week! Keep it up!";switch(l.rank){case 1:return"Incredible! You're the champion of the week!";case 2:return"Amazing work! You secured 2nd place!";case 3:return"Fantastic! You made it to the top 3!";default:return"Great effort last week! Keep it up!"}})()})]}),(0,s.jsx)("div",{className:"jsx-5161af47ea9df57d mt-4 space-y-4",children:r.map((e,t)=>(0,s.jsxs)("div",{className:"jsx-5161af47ea9df57d "+((0,m.cn)("p-3 border rounded-lg flex items-center gap-4 transition-all w-full",1===e.rank&&"bg-yellow-100/50 border-yellow-500 scale-105 shadow-lg",2===e.rank&&"bg-gray-100/50 border-gray-400",3===e.rank&&"bg-orange-100/50 border-orange-400",e.id===n&&"ring-2 ring-primary")||""),children:[(0,s.jsx)("div",{className:"jsx-5161af47ea9df57d flex items-center justify-center w-10 text-xl font-bold",children:(0,s.jsx)(d.A,{className:(0,m.cn)("w-8 h-8",1===e.rank&&"text-yellow-500 fill-yellow-400",2===e.rank&&"text-gray-400 fill-gray-300",3===e.rank&&"text-orange-600 fill-orange-400")})}),(0,s.jsx)(o.default,{src:e.avatar,alt:e.name,width:40,height:40,className:"rounded-full"}),(0,s.jsx)("div",{className:"jsx-5161af47ea9df57d flex-1",children:(0,s.jsx)("p",{className:"jsx-5161af47ea9df57d font-semibold",children:e.name})}),(0,s.jsxs)("div",{className:"jsx-5161af47ea9df57d flex items-center gap-1 text-sm font-semibold text-yellow-600",children:[(0,s.jsx)("span",{className:"jsx-5161af47ea9df57d",children:e.xp.toLocaleString()}),(0,s.jsx)(v.A,{className:"h-4 w-4 fill-current"})]})]},e.id))}),(0,s.jsx)(w.Es,{className:"mt-6",children:(0,s.jsx)(y.$,{onClick:a,className:"w-full",children:"Continue"})})]})]})}function b(){let e=(0,n.useSearchParams)().get("userId"),[t,a]=(0,r.useState)([]),[g,h]=(0,r.useState)(!0),[w,y]=(0,r.useState)(""),{t:v,language:j}=(0,u.o)(),[b,k]=(0,r.useState)(null),[S,z]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(e){var t;let s=await (0,l.kl)(e),r=await (0,c.MI)(e);if(!r.hasSeenLastWeekResults&&(null==(t=r.lastWeek)?void 0:t.winners)&&(k(r.lastWeek.winners),z(!0)),s&&s.supervisorId){let e=await (0,l.HV)(s.supervisorId),t=new Map;e.forEach(e=>t.set(e.id,e)),s&&t.set(s.id,s);let r=Array.from(t.values()).map(async e=>{let t=await (0,c.MI)(e.id);return{...e,xp:t.xp||0}}),n=await Promise.all(r);n.sort((e,t)=>t.xp-e.xp),a(n)}h(!1)}})();let t=(0,f.$)(new Date,{weekStartsOn:1}),s="ar"===j?{locale:p.ar}:{};y((0,x.m)(t,{addSuffix:!0,...s}));let r=setInterval(()=>{y((0,x.m)(t,{addSuffix:!0,...s}))},6e4);return()=>clearInterval(r)},[e,j]);let A=e=>0===e?(0,s.jsx)(d.A,{className:"w-6 h-6 text-yellow-500 fill-yellow-400"}):1===e?(0,s.jsx)(d.A,{className:"w-6 h-6 text-gray-400 fill-gray-300"}):2===e?(0,s.jsx)(d.A,{className:"w-6 h-6 text-orange-600 fill-orange-400"}):(0,s.jsx)("span",{className:"text-lg font-bold w-6 text-center",children:e+1});return g?(0,s.jsx)("div",{children:v("championPage.loading")}):(0,s.jsxs)("div",{className:"space-y-6",children:[b&&e&&(0,s.jsx)(N,{isOpen:S,onClose:()=>{z(!1),e&&(0,c.np)({userId:e,markAsSeen:!0})},winners:b,currentUserId:e}),(0,s.jsx)("h1",{className:"text-3xl font-bold font-headline",children:v("championPage.title")}),(0,s.jsx)("p",{className:"text-muted-foreground",children:v("championPage.description")}),(0,s.jsxs)(i.Zp,{children:[(0,s.jsxs)(i.aR,{children:[(0,s.jsx)(i.ZB,{children:v("championPage.weeklyRankings")}),(0,s.jsx)(i.BT,{children:v("championPage.leaderboardDescription",w)})]}),(0,s.jsx)(i.Wu,{children:t.length>0?(0,s.jsx)("ol",{className:"space-y-4",children:t.map((t,a)=>(0,s.jsxs)("li",{className:(0,m.cn)("p-4 border rounded-lg flex items-center gap-4 transition-all",e===t.id&&"bg-secondary border-primary",0===a&&"border-yellow-500 border-2",1===a&&"border-gray-400 border-2",2===a&&"border-orange-600 border-2"),children:[(0,s.jsx)("div",{className:"flex items-center justify-center w-8",children:A(a)}),(0,s.jsx)(o.default,{src:t.avatar,alt:t.name,width:48,height:48,className:"rounded-full"}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("p",{className:"font-semibold text-lg",children:[t.name," ",e===t.id&&v("championPage.you")]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-yellow-500 font-bold text-lg",children:[(0,s.jsx)("span",{children:t.xp.toLocaleString()}),(0,s.jsx)("span",{children:v("championPage.xp")})]})]},t.id))}):(0,s.jsx)("div",{className:"text-center text-muted-foreground py-12",children:v("championPage.noClassmates")})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,7416,4277,2557,3559,2075,6766,1298,1592,8887,3684,32,794,1858,8441,1684,7358],()=>t(403)),_N_E=e.O()}]);